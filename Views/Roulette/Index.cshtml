@using raptorSlot.Services.Games
@{
    ViewBag.Title = "Roulette";
}

<h2>Roulette</h2>

<div>
    <h3>Test Roulette Play</h3>
    
    <div>
        <label>Bet Type:</label>
        <select id="betType">
            <option value="@((int)BetType.STRAIGHT_UP)">@BetType.STRAIGHT_UP</option>
            <option value="@((int)BetType.SPLIT)">@BetType.SPLIT</option>
            <option value="@((int)BetType.STREET)">@BetType.STREET</option>
            <option value="@((int)BetType.RED_OR_BLACK)">@BetType.RED_OR_BLACK</option>
            <option value="@((int)BetType.ODD_OR_EVEN)">@BetType.ODD_OR_EVEN</option>
        </select>
    </div>
    
    <div>
        <label>Number(s) (comma-separated for SPLIT/STREET):</label>
        <input type="text" id="selectedNumbers" placeholder="e.g., 5 or 1,2" />
    </div>
    
    <div>
        <label>Wager Amount:</label>
        <input type="number" id="wagerAmount" value="10" />
    </div>
    
    <button id="playBtn">Play</button>
    
    <div id="result" style="margin-top: 20px;"></div>
</div>

<script>
    const play = async (wagerAmount, betType, selected) => {
        const payload = {
            wager: { wagerAmount, isPremiumToken: false },
            rouletteChoice: { betType, selected },
        };

        const response = await fetch('/api/games/roulette/play', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        return {ok: response.ok, body: response}
    }

    document.getElementById('playBtn').addEventListener('click', async () => {
        const betType = parseInt(document.getElementById('betType').value);
        const numbersInput = document.getElementById('selectedNumbers').value;
    const wagerAmount = parseInt(document.getElementById('wagerAmount').value);
    
    const selected = numbersInput.split(',').map(n => parseInt(n.trim()));
    
    const result = await play(wagerAmount, betType, selected);
    
    if(result.ok) {
        document.getElementById('result').innerHTML = `<pre>${JSON.stringify(await result.body.json(), null, 2)}</pre>`;
    } else {
        document.getElementById('result').innerHTML = `<span style="color: red;">Error: ${await result.body.text()}</span>`;
    }
});
</script>
